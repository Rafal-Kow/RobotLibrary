&ACCESS RV1
&REL 134
&PARAM DISKPATH = KRC:\R1\VW_User\Applikation\Conveyor
&PARAM TEMPLATE = C:\KRC\Roboter\Template\vw_usr_rv
&PARAM EDITMASK = vw_usr_r
&PARAM TPVW_VERSION = 8.1.8
DEFDAT  vw_conv_usr_r PUBLIC


;*** Basistech EXT ****************************************************
EXT  BAS (BAS_COMMAND  :IN,REAL  :IN )
DECL INT SUCCESS
;*************************************

;*** User EXT ******************************
;Make here your modifications
;****************************************
; Conveyor Techware System
; Data for measurement routine
; 2003_01_20 PB
;****************************************
INT TOOL_NR,CONV_NR,CONV_TYP
INT I
INT N=0 ;local tool number
INT CMD_OK=0 ; Profibus Return Value
INT CONVEYOR_DIR=3
INT CONVEYOR_MOV=3
REAL P_X[3],P_XY[3],P_Y[3],P_Z[3],T[3,3],P1P2,P1P3,P2P3,ALFA
REAL D_MIN=50.0 ; [mm]  Minimum distance for measuring positions
DECL FRAME PT_IN_WORLD[3] ; measured points
PT_IN_WORLD[1]={X 991.407715,Y -1121.00635,Z 577.788147,A 42.434742,B 88.8602753,C -144.800461}
PT_IN_WORLD[2]={X 989.46283,Y -551.000732,Z 581.290955,A 42.4376602,B 88.8602524,C -144.79808}
PT_IN_WORLD[3]={X 1054.26318,Y -551.000732,Z 581.290955,A 42.4376602,B 88.8602524,C -144.79808}
;LINEAR CONVEYOR / PART-BASE
FRAME NEW_BASE={X 991.407715,Y -1121.00635,Z 577.788147,A 90.1954956,B -0.352088481,C 179.99881}
REAL ALFA_MIN=2.5 ; [deg]  Minimum difference in angle point XY plane
;CIRCULAR CONVEYOR
FRAME CENTER={X -1304.7168,Y 1729.4231,Z 1170.63159,A -161.620773,B -8.15971756,C 171.592865}
REAL RADIUS=744.929443
REAL ALFA1=33.7896233 ; [deg] angle between circ point 1-2
REAL ALFA2=39.0445061 ; [deg] angle between circ point 2-3
REAL ALFA3=72.834137 ; [deg] angle between circ point 1-3
REAL ALFA_ERR=1.0 ; [deg] maximum error on angle calculation
;****************************************************************************


EXTFCT  INT  SELECT(SUBTYPE  :IN,INT  :IN,BOOL  :IN,ARI_TYP  :IN,INT  :IN,BOOL_TYP  :IN,INT  :IN,BOOL  :IN)

INT UP_PAR1=8 ;=PARA1  INI_OFF, CONV ON, CONVvFOLLOW
INT UP_PAR2=9999 ;=PARA2, UP1(),UP2(),UP3()
INT UP_PAR3=802 ;=PARA3,
INT UP_PAR4=9999 ;=PARA4, E-NR
INT UP_PAR5=9999 ;=PARA5, TIMEOUT in 1/10sec
INT UP_PAR6=11 ;=PARA6,
BOOL UP_PAR7=TRUE ;=PARA7, soll auf TRUE oder FALSE gestetzt werden
INT UP_CMD_SEL=802 ;lokale variable technologiepaket CMD_SEL


GLOBAL BOOL B_MIT_CONV=TRUE
GLOBAL INT F_M_CONV=249

;*** ConveyorTech Globals *********************************************

;CONV Booleans
BOOL B_CALL_CONV_MOV=FALSE
BOOL B_QUIT_BECAUSE_MAX_DIST=FALSE
BOOL B_QUIT_BECAUSE_EMS=FALSE
BOOL B_CONTINUE_AFTER_EMS=TRUE
BOOL Schalter=FALSE
;CONV Reals
REAL R_CONV_POS_OLD=385.486908
REAL R_CONV_POSI=75.6515045
REAL R_MAX_DIST=0.0
REAL R_ALARM_DIST_CONV[3]
R_ALARM_DIST_CONV[1]=200.0
R_ALARM_DIST_CONV[2]=5000.0
R_ALARM_DIST_CONV[3]=5000.0

REAL MAX_DIST_ABS1=2000.0
GLOBAL REAL R_MAX_DIST_CONV[3]
R_MAX_DIST_CONV[1]=200.0
R_MAX_DIST_CONV[2]=5800.0
R_MAX_DIST_CONV[3]=3000.0
REAL R_CAL_DIG[3]
R_CAL_DIG[1]=-1.01867318
R_CAL_DIG[2]=1.43526006
R_CAL_DIG[3]=0.100000001
REAL REAL_ARRAY[10]
REAL R_DELAY_TIME_CONV[3]
R_DELAY_TIME_CONV[1]=20.0
R_DELAY_TIME_CONV[2]=24.0
R_DELAY_TIME_CONV[3]=24.0

;CONV Integers
INT Z_COUNTER=11
INT Z_MD_CMD_RET=0
INT Z_CONV_TIMER_NBR=1
INT Z_CONV_NUMBER=1
INT Z_PAR_NUMBER=1
INT Z_DIALOG_ANSWER=-1
INT Z_ALARM_DIST_INT_NBR[3]
Z_ALARM_DIST_INT_NBR[1]=31
Z_ALARM_DIST_INT_NBR[2]=32
Z_ALARM_DIST_INT_NBR[3]=33
INT Z_MAX_DIST_INT_NBR[3]
Z_MAX_DIST_INT_NBR[1]=34
Z_MAX_DIST_INT_NBR[2]=35
Z_MAX_DIST_INT_NBR[3]=36
INT Z_EMS_INT_NBR[3]
Z_EMS_INT_NBR[1]=37
Z_EMS_INT_NBR[2]=38
Z_EMS_INT_NBR[3]=39
INT Z_SEN_PREA_NBR[3]
Z_SEN_PREA_NBR[1]=1
Z_SEN_PREA_NBR[2]=2
Z_SEN_PREA_NBR[3]=3
INT Z_EMS_OUT_NBR[3]
Z_EMS_OUT_NBR[1]=1
Z_EMS_OUT_NBR[2]=2
Z_EMS_OUT_NBR[3]=3
INT Z_DIST_ALARM_OUT_NBR[3]
Z_DIST_ALARM_OUT_NBR[1]=4
Z_DIST_ALARM_OUT_NBR[2]=5
Z_DIST_ALARM_OUT_NBR[3]=6
INT Z_COUNT_RUNNING_IN_NBR[3]
Z_COUNT_RUNNING_IN_NBR[1]=867
Z_COUNT_RUNNING_IN_NBR[2]=875
Z_COUNT_RUNNING_IN_NBR[3]=947
INT INT_ARRAY[10]

;CONV Miscellaneous
DECL TECHGEOREF COR_DIR[3]
COR_DIR[1]=#X
COR_DIR[2]=#NONE
COR_DIR[3]=#NONE

BOOL B_INPUT_LEVEL1=TRUE ;CONV1
BOOL B_INPUT_LEVEL2=TRUE ;CONV2
BOOL B_INPUT_LEVEL3=TRUE ;CONV3
REAL R_MINDIST1=0.0 ;CONV1
REAL R_MINDIST2=0.0 ;CONV2
REAL R_MINDIST3=0.0 ;CONV3
REAL R_MAXDIST1=200.0 ;CONV1
REAL R_MAXDIST2=1000.0 ;CONV2
REAL R_MAXDIST3=1000.0 ;CONV3

BOOL B_STOP_AFTER_LEAVING1=FALSE ;CONV1
BOOL B_STOP_AFTER_LEAVING2=FALSE ;CONV3
BOOL B_STOP_AFTER_LEAVING3=FALSE ;CONV3

;Base zum vermessen, wird durch vw_usr nach MACHINE_DEF[11].ROOT kopiert
INT BASE_FUER_CONV=10


ENDDAT